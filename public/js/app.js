var app=angular.module("kickerApp",[]).config(["$httpProvider","$interpolateProvider",function(t,a){a.startSymbol("<%"),a.endSymbol("%>")}]);app.factory("User",["$http",function(t){function a(t){var a=this;return this.setData=function(t){angular.extend(this,t)},this.countGames=function(){return a.count_looses+a.count_wins+a.count_draws},this.avatarUrl=function(){return a.avatar_url?a.avatar_url:"/img/no-avatar.min.png"},t&&this.setData(t),this}return a}]),app.controller("ChartsCtrl",["$scope","$http","User",function(t,a,n){t.users=[],t.init=function(){t.loading=!0,a.get("/chart").success(function(a){angular.forEach(a,function(t,a){t.index=a+1;var e=new n(t);this.push(e)},t.users)})},t.init()}]),app.factory("GameUser",["$http","User",function(t,a){function n(t){var n=this;return this.setData=function(t){angular.extend(this,t),n.user=new a(n.user)},this.getDelta=function(){return n.rating_after-n.rating_before},this.userPointsClass=function(){return n.getDelta()>0?"win":"lose"},t&&this.setData(t),this}return n}]),app.factory("Game",["$http","GameUser",function(t,a){function n(t){var n=this;return this.setData=function(t){angular.extend(this,t);for(var e=0;e<n.games_users_a.length;e++)n.games_users_a[e]=new a(n.games_users_a[e]);for(e=0;e<n.games_users_b.length;e++)n.games_users_b[e]=new a(n.games_users_b[e])},this.gamePointClass=function(t){var a=n.team_a_points,e=n.team_b_points;return"b"===t&&(a=n.team_b_points,e=n.team_a_points),a>e?"win":e>a?"lose":"draw"},t&&this.setData(t),this}return n}]),app.controller("GamesCtrl",["$scope","$http","Game",function(t,a,n){function e(a){angular.forEach(a,function(t){var a=new n(t);this.push(a),r[a.id]=this.length-1},t.games)}t.lastpage=1,t.currentpage=0,t.games=[],t.loading=!1;var r={};t.init=function(){a({url:"/",method:"GET",params:{page:t.currentpage}}).success(function(a){t.currentpage=a.current_page,t.lastpage=a.last_page,e(a.data)})},t.loadMore=function(){t.loading=!0,a({url:"/",method:"GET",params:{page:t.currentpage+1}}).success(function(a){t.currentpage=a.current_page,t.lastpage=a.last_page,e(a.data),t.loading=!1})},t.complain=function(e){a.get("/game/"+e+"/complain").success(function(s){a.get("/game/"+e).success(function(a){var e=new n(a),s=r[e.id];t.games[s]=e})})},t.init()}]);