var app=angular.module("kickerApp",["ngRoute"]).config(["$httpProvider","$interpolateProvider","$routeProvider",function(t,n,e){n.startSymbol("<%"),n.endSymbol("%>"),e.when("/signup",{templateUrl:"html/views/auth/signup.html",controller:"SignupCtrl"}).when("/signin",{templateUrl:"html/views/auth/signin.html",controller:"SigninCtrl"}).when("/",{templateUrl:"html/views/games/index.html"}).when("/chart",{templateUrl:"html/views/chart/index.html"}).when("/_=_",{templateUrl:"html/views/games/index.html"})}]);app.factory("User",["$http",function(t){function n(t){var n=this;return this.setData=function(t){angular.extend(this,t)},this.countGames=function(){return n.count_looses+n.count_wins+n.count_draws},this.avatarUrl=function(){return n.avatar_url?n.avatar_url:"/img/no-avatar.min.png"},t&&this.setData(t),this}return n}]),app.controller("ChartsCtrl",["$scope","$http","User",function(t,n,e){t.users=[],t.init=function(){t.loading=!0,n.get("/chart").success(function(n){angular.forEach(n,function(t,n){t.index=n+1;var r=new e(t);this.push(r)},t.users)})},t.init()}]),app.factory("GameUser",["$http","User",function(t,n){function e(t){var e=this;return this.setData=function(t){angular.extend(this,t),e.user=new n(e.user)},this.getDelta=function(){return e.rating_after-e.rating_before},this.userPointsClass=function(){return e.getDelta()>0?"win":"lose"},t&&this.setData(t),this}return e}]),app.factory("Game",["$http","GameUser",function(t,n){function e(t){var e=this;return this.setData=function(t){angular.extend(this,t);for(var r=0;r<e.games_users_a.length;r++)e.games_users_a[r]=new n(e.games_users_a[r]);for(r=0;r<e.games_users_b.length;r++)e.games_users_b[r]=new n(e.games_users_b[r])},this.gamePointClass=function(t){var n=e.team_a_points,r=e.team_b_points;return"b"===t&&(n=e.team_b_points,r=e.team_a_points),n>r?"win":r>n?"lose":"draw"},t&&this.setData(t),this}return e}]),app.controller("GamesCtrl",["$scope","$http","Game",function(t,n,e){function r(n){angular.forEach(n,function(t){var n=new e(t);this.push(n),a[n.id]=this.length-1},t.games)}function s(){n({url:"/user/role",method:"GET"}).success(function(n){"guest"===n?t.user.isGuest=!0:"user"===n?t.user.isUser=!0:"admin"===n&&(t.user.isAdmin=!0)})}t.lastpage=1,t.currentpage=0,t.games=[],t.loading=!1,t.user={isGuest:!1,isUser:!1,isAdmin:!1};var a={};t.userRole=s(),t.init=function(){n({url:"/",method:"GET",params:{page:t.currentpage}}).success(function(n){t.currentpage=n.current_page,t.lastpage=n.last_page,r(n.data)})},t.loadMore=function(){t.loading=!0,n({url:"/",method:"GET",params:{page:t.currentpage+1}}).success(function(n){t.currentpage=n.current_page,t.lastpage=n.last_page,r(n.data),t.loading=!1})},t.complain=function(r){n.get("/game/"+r+"/complain").success(function(s){n.get("/game/"+r).success(function(n){var r=new e(n),s=a[r.id];t.games[s]=r})})},t.init()}]),app.factory("AuthUser",["$http",function(t){function n(t){return this.email=null,this.name=null,this.password=null,this.setData=function(t){angular.extend(this,t)},t&&this.setData(t),this}return n}]),app.controller("SignupCtrl",["$scope","$http","$location","$window","AuthUser",function(t,n,e,r,s){t.user=new s,t.errors=[],t.signup=function(e){n({url:"/signup",method:"POST",data:t.user}).success(function(){r.location.href="/"}).error(function(n){t.errors=[];for(var e in n)if(n.hasOwnProperty(e))for(var r=0;r<n[e].length;r++)t.errors.push(n[e][r])})}}]),app.controller("SigninCtrl",["$scope","$http","$location","$window","AuthUser",function(t,n,e,r,s){t.user=new s,t.errors=[],t.signin=function(e){n({url:"/signin",method:"POST",data:t.user}).success(function(t){r.location.href="/"}).error(function(n){t.errors=[];for(var e in n)if(n.hasOwnProperty(e))for(var r=0;r<n[e].length;r++)t.errors.push(n[e][r])})}}]);